if(!Fireball){var Fireball={}}Fireball.ACP={};Fireball.ACP.Content={};Fireball.ACP.Content.AddDialog=Class.extend({_proxy:null,_cache:{},_dialog:null,init:function(){this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});$(".jsContentAddButton").click($.proxy(this._click,this))},_click:function(a){a.preventDefault();var b=$(a.currentTarget);this._proxy.setOption("data",{actionName:"getContentTypes",className:"cms\\data\\page\\PageAction",objectIDs:[b.data("objectID")],parameters:{position:b.data("position"),parentID:b.data("parentID")}});this._proxy.sendRequest()},_show:function(a){this._dialog=$('<div id="contentAddDialog">'+this._cache[a]+"</div>").appendTo(document.body);this._dialog.wcfDialog({title:WCF.Language.get("cms.acp.content.add")})},_success:function(b,c,a){this._cache[b.returnValues.pageID]=b.returnValues.template;this._show(b.returnValues.pageID)}});Fireball.ACP.Content.Clipboard={};Fireball.ACP.Content.Clipboard.ContentMovement=Class.extend({_pageID:0,init:function(a){this._pageID=a;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});var b=this;require(["EventHandler","WoltLabSuite/Core/Controller/Clipboard"],function(d,c){d.add("com.woltlab.wcf.clipboard","de.codequake.cms.content",function(f){if(f.data.actionName=="de.codequake.cms.content.copyTo"){var e=f.data.parameters.objectIDs;b._proxy.setOption("data",{actionName:"copyTo",className:"cms\\data\\content\\ContentAction",objectIDs:e,parameters:{pageID:b._pageID}});b._proxy.sendRequest()}else{if(f.data.actionName=="de.codequake.cms.content.moveTo"){var e=f.data.parameters.objectIDs;b._proxy.setOption("data",{actionName:"moveTo",className:"cms\\data\\content\\ContentAction",objectIDs:e,parameters:{pageID:b._pageID}});b._proxy.sendRequest()}}})})},triggerEffect:function(a){console.log("triggerEffect")},_success:function(a){window.location.reload()}});Fireball.ACP.Content.Type={};Fireball.ACP.Content.Type["de.codequake.cms.content.type.columns"]=Class.extend({_addButton:null,_columnCount:0,_columnData:null,_container:null,_maxColumnCount:5,_minColumnCount:2,_minColumnWidth:20,_mouseDifference:0,init:function(b){this._columnData=[];this._addButton=$(".jsAddColumn");this._container=$("#columnContainer");for(var a=0;a<this._minColumnCount||a<b.length;a++){this._addColumn(b[a]||Math.round(100/this._minColumnCount))}this._container.mouseup($.proxy(this._mouseup,this));this._addButton.click($.proxy(function(d){d.preventDefault();if(this._addColumn(0)){var c=Math.round(100/this._columnCount);this._setWidth(this._columnCount,c)}},this))},_addColumn:function(d){if(this._columnCount==this._maxColumnCount){return false}this._columnCount++;var b=$('<div class="grid" data-column-number="'+this._columnCount+'"></div>').appendTo(this._container);var c=$("<div></div>").appendTo(b);var a=$('<div class="gridNumber"></div>').appendTo(c);$("<span>"+this._columnCount+"</span>").appendTo(a);$('<input type="number" name="contentData[columnData][]" min="'+this._minColumnWidth+'" />').keydown($.proxy(this._preventSubmit,this)).change($.proxy(this._change,this)).appendTo(a);$('<button type="button">'+WCF.Language.get("wcf.global.button.delete")+"</button>").click($.proxy(this._deleteClick,this)).appendTo(a);$('<div class="gridResize"></div>').mousedown($.proxy(this._mousedown,this)).appendTo(b);this._columnData.push(d);this._updateGUI();return true},_change:function(c){var d=$(c.currentTarget);var b=parseInt(d.parents(".grid").data("columnNumber"));var a=parseInt(d.val());this._setWidth(b,a)},_deleteClick:function(b){var c=$(b.currentTarget);var a=parseInt(c.parents(".grid").data("columnNumber"));this._deleteColumn(a)},_deleteColumn:function(b){if(this._columnCount==this._minColumnCount){console.debug("[Fireball.ACP.Content.Type['de.codequake.cms.content.type.columns']] Couldn't delete column '"+b+"', reached min column count.");return}var d=b+1;if(d>this._columnCount){d=b-1}var a=this._columnData[b-1];var c=this._columnData[d-1]+a;this._columnData.splice(b-1,1);this._container.children(":nth-child("+b+")").remove();this._columnCount--;if(d>b){d--}this._columnData[d-1]=c;this._updateGUI()},_mousedown:function(b){b.preventDefault();var c=$(b.currentTarget);var a=c.parent();this._mouseDifference=b.originalEvent.clientX-(c.offset().left+c.innerWidth())+$(window).scrollLeft();this._container.mousemove($.proxy(this._mousemove,this,a))},_mousemove:function(c,e){var b=c.data("columnNumber");var d=e.pageX-c.offset().left-this._mouseDifference;var a=Math.round(d/this._container.width()*100);if(a!=this._columnData[b-1]){this._setWidth(b,a)}},_mouseup:function(){this._container.unbind("mousemove")},_preventSubmit:function(a){if(a.keyCode==$.ui.keyCode.ENTER){a.preventDefault();this._change(a)}},_updateGUI:function(){var c,a;for(var b=1;b<=this._columnCount;b++){c=this._container.children(":nth-child("+b+")");a=this._columnData[b-1];c.data("columnNumber",b);c.innerWidth(a+"%");c.find("span").text(b);c.find("input").val(a).prop("max",100-this._minColumnWidth*(this._columnCount-1))}if(this._columnCount==this._maxColumnCount){this._addButton.prop("disabled",true)}else{this._addButton.prop("disabled",false)}if(this._columnCount<=this._minColumnCount){this._container.find("button").prop("disabled",true)}else{this._container.find("button").prop("disabled",false)}},_setWidth:function(b,d){if(b>this._columnCount){console.debug("[Fireball.ACP.Content.Type['de.codequake.cms.content.type.columns']] Couldn't set column width for column '"+b+"', out of boundary.");return}if(d==this._columnData[b-1]){return true}var g=false,f,c;if(d<this._minColumnWidth){return false}if(this._columnCount==1){this._columnData[0]=d;this._container.children().innerWidth(d+"%");return true}c=1;do{f=b+c;c++}while(d>this._columnData[b-1]&&f<=this._columnCount&&this._columnData[f-1]<=this._minColumnWidth);if(d>this._columnData[b-1]&&(f>this._columnCount||this._columnData[f-1]<=this._minColumnWidth)){c=1;do{f=b-c;c++}while(f>1&&this._columnData[f-1]<=this._minColumnWidth);if(f<1||this._columnData[f-1]<=this._minColumnWidth){return false}}var a=d;for(c=1;c<=this._columnCount;c++){if(c!==b&&c!==f){a+=this._columnData[c-1]}}var e=100-a;if(e<this._minColumnWidth){g=d;e=this._minColumnWidth;d=100-(a+e-d)}this._columnData[b-1]=d;this._columnData[f-1]=e;this._updateGUI();if(g){this._setWidth(b,g)}}});Fireball.ACP.Content.Type["de.codequake.cms.content.type.graph.pie"]=Class.extend({init:function(){this._columnData=[];this._addButton=$(".jsAddGraphOption");this._container=$(".graphOptionContainer > ul");$(".graphOptionContainer .jsLineRemoveButton").click($.proxy(this._deleteGraphOption,this));this._addButton.click($.proxy(this._addGraphOption,this))},_addGraphOption:function(){var a=this._container.find("li:last-child").data("counter")+1;var b=$('<li class="left" data-counter="'+a+'"><input type="text" name="contentData[graphOptions][title][]" value="" class="long" required /></li><li class="right" data-counter="'+a+'"><input type="number" name=contentData[graphOptions][value][]" value="" class="tiny" required /></li><li class="iconList" data-counter="'+a+'"><span class="icon icon16 fa-remove pointer jsLineRemoveButton"></span></li>');$(b[2]).find(".jsLineRemoveButton").click($.proxy(this._deleteGraphOption,this));this._container.append(b)},_deleteGraphOption:function(b){var a=$(b.currentTarget).parent().data("counter");this._container.find('li[data-counter="'+a+'"]').remove()}});Fireball.ACP.File={};Fireball.ACP.File.ImageRatio=Class.extend({_ratio:1,init:function(a){new WCF.Action.Proxy({autoSend:true,data:{actionName:"getSize",className:"cms\\data\\file\\FileAction",objectIDs:[a]},success:$.proxy(this._success,this)});$("#width").change($.proxy(this._calculateHeight,this));$("#height").change($.proxy(this._calculateWidth,this))},_calculateHeight:function(){var b=$("#width");var a=b.val()/this._ratio;$("#height").val(Math.round(a))},_calculateWidth:function(){var a=$("#height");var b=a.val()*this._ratio;$("#width").val(Math.round(b))},_success:function(b,c,a){this._ratio=b.returnValues.width/b.returnValues.height}});Fireball.ACP.File.Picker=Class.extend({_currentlyOpenCategory:0,_dialog:null,_inputName:"",_options:null,_proxy:null,_selectButton:null,_selected:null,_sortOrder:null,init:function(e,c,d,b){this._selectButton=e;this._inputName=c;this._selected=d||{};this._options=$.extend(true,{multiple:false,fileType:""},b);this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});var a=this._selectButton.parents("form");if(!a.length){console.debug("[Fireball.ACP.File.Picker] Unable to determine form for file picker, aborting.");return}a.submit($.proxy(this._submit,this));this._selectButton.click($.proxy(this._openPicker,this));if(b.sortOrder!=undefined){this._sortOrder=b.sortOrder}this._updateSelectedFilesList(true)},selectFiles:function(f,b){if(!this._options.multiple){var e=Object.keys(f);var c=f;f={};f[e[0]]=c[e[0]]}var d;for(var a in f){if(!f.hasOwnProperty(a)){continue}d=f[a];if(this._selected[a]===undefined){this._selected[a]=d;if(b!==false){this._dialog.find('tr[data-file-id="'+a+'"]').find("input").prop("checked",true)}}}this._updateSelectedFilesList()},_dropdownCategoryClick:function(b){var a=$(b.currentTarget).data("categoryID");this._openCategory(a)},_inputClick:function(d){var e=$(d.currentTarget);var c=e.parents("tr");var a=e.val();if(e.is(":checked")){this._selected[a]=fileData={fileID:a,title:c.data("fileTitle"),formattedFilesize:c.data("fileFormattedSize")}}else{delete this._selected[a]}if(!this._options.multiple){new Fireball.ACP.File.ImageRatio(e.val());var b=this;$.each(b._selected,function(f){if(f!=e.val()){delete b._selected[f]}})}this._updateSelectedFilesList()},_openCategory:function(c){var b=this._dialog.find('.tabularBox[data-category-id="'+c+'"]');if(b.length){this._currentlyOpenCategory=c;this._dialog.find(".tabularBox").hide();b.show();var a=WCF.Dropdown.getDropdownMenu($(".filePickerCategoryDropdown").wcfIdentify());a.find("li.active").removeClass("active");a.find('li[data-category-id="'+c+'"]').addClass("active");this._dialog.wcfDialog("render")}else{this._proxy.setOption("data",{actionName:"getFileList",className:"cms\\data\\file\\FileAction",parameters:{categoryID:c,fileType:this._options.fileType}});this._proxy.sendRequest()}},_openPicker:function(){if(this._dialog===null){this._proxy.setOption("data",{actionName:"getFileList",className:"cms\\data\\file\\FileAction",parameters:{fileType:this._options.fileType}});this._proxy.sendRequest()}else{this._dialog.wcfDialog("open")}},_reload:function(){this._dialog.find(".tabularBox").remove();this._openCategory(this._currentlyOpenCategory)},_submit:function(d){var a=$(d.currentTarget);if(this._options.multiple){var e=this;$.each(this._selected,function(f,g){$('<input type="hidden" name="'+e._inputName+'[]" value="'+f+'" />').appendTo(a)})}else{var c=Object.keys(this._selected);var b=this._selected[c[0]];if(typeof b!=="undefined"){$('<input type="hidden" name="'+this._inputName+'" value="'+b.fileID+'" />').appendTo(a)}else{$('<input type="hidden" name="'+this._inputName+'" value="0" />').appendTo(a)}}},_success:function(b,c,a){if(this._dialog===null){this._dialog=$(b.returnValues.template).hide();this._dialog.find(".filePickerCategoryDropdown li").click($.proxy(this._dropdownCategoryClick,this));this._currentlyOpenCategory=b.returnValues.categoryID;this._dialog.appendTo("body");this._dialog.wcfDialog({title:b.returnValues.title});Fireball.ACP.File.Upload.init($.proxy(this._uploadCallback,this))}else{$(b.returnValues.template).hide().appendTo(this._dialog);this._openCategory(b.returnValues.categoryID)}this._dialog.find("td.columnMark").each($.proxy(function(e,h){var f=$(h),d=f.parent().data("fileID"),g;if(f.children(".filePickerCheckBox").val()!==undefined){return}if(this._options.multiple){g=$('<input type="checkbox" class="filePickerCheckBox" name="'+this._inputName+'[]" value="'+d+'" />').appendTo(f)}else{g=$('<input type="radio" class="filePickerCheckBox" name="'+this._inputName+'" value="'+d+'" />').appendTo(f)}if(this._selected[d]!==undefined){g.prop("checked",true)}g.click($.proxy(this._inputClick,this))},this))},_updateSelectedFilesList:function(c){var b=this._selectButton.parent().children("#filePickerList");b.html("");var a=this;if(c){$.each(this._sortOrder,function(f,d){var e=a._selected[d];if(e.imageUrl){$('<li class="sortableNode filePickerItem" data-object-id="'+d+'"><span class="sortableNodeLabel"><img src="'+e.imageUrl+'" /><div><p class="cmsFileLink" data-file-id="'+d+'">['+d+"] "+e.title+"</p><small>"+e.formattedFilesize+'</small><input type="hidden" name="'+a._inputName+'[ordered][]" value="'+d+'" /></div></span></li>').appendTo(b)}else{$('<li class="sortableNode filePickerItem" data-object-id="'+d+'"><span class="sortableNodeLabel"><span class="icon icon64 fa-paperclip"></span><div><p class="cmsFileLink" data-file-id="'+d+'">['+d+"] "+e.title+"</p><small>"+e.formattedFilesize+'</small><input type="hidden" name="'+a._inputName+'[ordered][]" value="'+d+'" /></div></span></li>').appendTo(b)}})}else{$.each(this._selected,function(d,e){if(e.imageUrl){$('<li class="sortableNode filePickerItem" data-object-id="'+d+'"><span class="sortableNodeLabel"><img src="'+e.imageUrl+'" /><div><p class="cmsFileLink" data-file-id="'+d+'">['+d+"] "+e.title+"</p><small>"+e.formattedFilesize+'</small><input type="hidden" name="'+a._inputName+'[ordered][]" value="'+d+'" /></div></span></li>').appendTo(b)}else{$('<li class="sortableNode filePickerItem" data-object-id="'+d+'"><span class="sortableNodeLabel"><span class="icon icon64 fa-paperclip"></span><div><p class="cmsFileLink" data-file-id="'+d+'">['+d+"] "+e.title+"</p><small>"+e.formattedFilesize+'</small><input type="hidden" name="'+a._inputName+'[ordered][]" value="'+d+'" /></div></span></li>').appendTo(b)}})}},_uploadCallback:function(a){this.selectFiles(a,false);this._reload()}});Fireball.ACP.File.Preview=WCF.Popover.extend({_proxy:null,init:function(){this._super(".cmsFileLink");this._proxy=new WCF.Action.Proxy({showLoadingOverlay:false})},_loadContent:function(){var a=$("#"+this._activeElementID);this._proxy.setOption("data",{actionName:"getFilePreview",className:"cms\\data\\file\\FileAction",objectIDs:[a.data("fileID")]});var c=this._activeElementID;var b=this;this._proxy.setOption("success",function(e,f,d){b._insertContent(c,e.returnValues.template,true)});this._proxy.sendRequest()}});Fireball.ACP.File.Upload={_afterSubmit:null,_categoryInput:null,_dialog:null,_files:null,_proxy:null,_submitButton:null,init:function(a){this._afterSubmit=a||null;this._files={};this._proxy=new WCF.Action.Proxy();$(".jsFileUploadButton").click($.proxy(this._openDialog,this))},addFile:function(a){this._files[a.fileID]=a;this._handleButtonState()},redraw:function(){if(this._dialog!==null){this._dialog.wcfDialog("render")}},_finalizeUpload:function(a){a.preventDefault();if($.isEmptyObject(this._files)){console.log("[Fireball.ACP.File.Upload] Tried to finalize upload though no files where uploaded, aborting.");return}var b=this._categoryInput.val();if(b===null){console.debug("[Fireball.ACP.File.Upload] Tried to finalize upload without a selected category, aborting.");return}this._submitButton.attr("disabled","disabled");this._proxy.setOption("data",{actionName:"update",className:"cms\\data\\file\\FileAction",objectIDs:Object.keys(this._files),parameters:{categoryIDs:b}});this._proxy.setOption("success",$.proxy(function(){this._dialog.wcfDialog("close");new WCF.PeriodicalExecuter($.proxy(function(c){this._dialog.parents(".dialogContainer").remove();this._dialog=null;c.stop()},this),200);if($.isFunction(this._afterSubmit)){this._afterSubmit(this._files)}},this));this._proxy.sendRequest()},_handleButtonState:function(){if($.isEmptyObject(this._files)){this._submitButton.prop("disabled",true);return}if(this._categoryInput.val()===null){this._submitButton.prop("disabled",true);return}this._submitButton.prop("disabled",false)},_openDialog:function(){if(this._dialog===null){this._proxy.setOption("data",{actionName:"getUploadDialog",className:"cms\\data\\file\\FileAction"});this._proxy.setOption("success",$.proxy(this._openDialogResponse,this));this._proxy.sendRequest()}else{this._dialog.wcfDialog("render")}},_openDialogResponse:function(b,c,a){this._dialog=$(b.returnValues.template).hide().appendTo("body");this._categoryInput=$("#categoryIDs");this._categoryInput.change($.proxy(this._handleButtonState,this));this._submitButton=$("#fileUploadSubmitButton");this._submitButton.click($.proxy(this._finalizeUpload,this));new Fireball.ACP.File.Upload.Handler();this._dialog.wcfDialog({title:b.returnValues.title})}};Fireball.ACP.File.Upload.Handler=WCF.Upload.Parallel.extend({init:function(a){this._super($("#fileUploadButton"),$(".fileUpload ul"),"cms\\data\\file\\FileAction")},_error:function(a,c,b){console.log(a,c,b)},_initFile:function(b){var a=$('<li class="box32"><span class="icon icon32 fa-spinner" /><div><div><p>'+b.name+'</p><small><progress max="100"></progress></small></div></div></li>').appendTo(this._fileListSelector);Fireball.ACP.File.Upload.redraw();return a},_success:function(d,c){var e=this._uploadMatrix[d];e.find("progress").remove();if(c.returnValues.files[d]){var a=c.returnValues.files[d];Fireball.ACP.File.Upload.addFile(a);e.children(".fa-spinner").removeClass("fa-spinner").addClass("fa-paperclip");e.find("small").append(a.formattedFilesize)}else{var b="uploadFailed";if(c.returnValues.errors[d]){b=c.returnValues.errors[d].errorType}e.children(".fa-spinner").removeClass("fa-spinner").addClass("fa-ban-circle");e.find("div > div").append($('<small class="innerError">'+WCF.Language.get("cms.acp.file.error."+b)+"</small>"));e.addClass("uploadFailed")}e.css("display","block");Fireball.ACP.File.Upload.redraw();WCF.DOMNodeInsertedHandler.execute()}});Fireball.ACP.Page={};Fireball.ACP.Page.Alias={};Fireball.ACP.Page.Alias.Preview=Class.extend({_aliasInput:null,_dummyPageLink:"",_parentPageSelect:null,init:function(c,a,b){this._dummyPageLink=b;this._aliasInput=$(c);this._parentPageSelect=$(a);if(!this._aliasInput.length){console.debug("[Fireball.ACP.Page.Alias.Preview] Invalid alias input selector given, aborting.");return}this._previewElement=this._aliasInput.parent().find(".jsAliasPreview");if(!this._previewElement.length){console.debug("[Fireball.ACP.Page.Alias.Preview] Unable to find preview element, aborting.");return}this._aliasInput.keyup($.proxy(this._change,this));if(!this._parentPageSelect.length){this._parentPageSelect.change($.proxy(this._change,this))}this._change()},_change:function(){var b="";var a=this._aliasInput.val();var c="";if(!this._parentPageSelect.length){b=this._parentPageSelect.children("option:selected").data("alias")}if(a!=""){if(b){c+=b+"/"}c+=a;this._previewElement.html(this._dummyPageLink.replace("123456789",c)).show()}else{this._previewElement.hide()}}});Fireball.ACP.Page.Menu=Class.extend({init:function(){$("#menuItemParameters").change($.proxy(this._showNotice,this));$("#menuItemController").change($.proxy(this._showNotice,this));$("#menuItemParametersContainer > dd").append('<p id="cmsNoticeContainer" />');this._showNotice()},_showNotice:function(){if($("#menuItemController").val()=="cms\\page\\PagePage"){$("#cmsNoticeContainer").html("<small>"+WCF.Language.get("wcf.acp.pageMenu.parameters.notice")+"</small>")}else{$("#cmsNoticeContainer").html("")}}});Fireball.ACP.Page.Revisions=Class.extend({_proxy:null,_cache:{},_dialog:null,init:function(){this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._buttons=$(".jsRevisionsButton");this._buttons.click($.proxy(this._click,this));new WCF.Action.Delete("cms\\data\\page\\revision\\PageRevisionAction",".jsRevisionRow")},_click:function(b){b.preventDefault();var a=$(b.currentTarget).data("objectID");this._proxy.setOption("data",{actionName:"getRevisions",className:"cms\\data\\page\\PageAction",objectIDs:[a]});this._proxy.sendRequest()},_show:function(a){this._dialog=$('<div id="revisionDialog">'+this._cache[a]+"</div>").appendTo(document.body);this._dialog.wcfDialog({title:WCF.Language.get("cms.acp.page.revision.list")})},_success:function(b,c,a){this._cache[b.returnValues.pageID]=b.returnValues.template;this._show(b.returnValues.pageID)}});Fireball.ACP.Page.Revisions.Restore=Class.extend({_proxy:null,_didInit:false,init:function(){if(this._didInit){return}this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._buttons=$(".jsRestoreRevisionButton");this._buttons.click($.proxy(this._click,this));this._didInit=true},_click:function(b){b.preventDefault();var a=$(b.currentTarget);if(a.data("confirmMessage")){WCF.System.Confirmation.show(a.data("confirmMessage"),$.proxy(this._execute,this),{target:a})}else{WCF.LoadingOverlayHandler.updateIcon(a);this._sendRequest(a)}},_sendRequest:function(b){var a=$(b).data("objectID");this._proxy.setOption("data",{actionName:"restore",className:"cms\\data\\page\\revision\\PageRevisionAction",objectIDs:[a]});this._proxy.sendRequest()},_execute:function(b,a){if(b==="cancel"){return}WCF.LoadingOverlayHandler.updateIcon(a.target);this._sendRequest(a.target)},_success:function(b,d,a){var c=new WCF.System.Notification(WCF.Language.get("wcf.global.success"));c.show(function(){window.location=location})}});Fireball.ACP.Page.TypePicker=Class.extend({_proxy:null,_didInit:false,_objectTypeID:0,_pageID:0,init:function(b,a){if(this._didInit){return}this._objectTypeID=b;if(a!=undefined){this._pageID=a}this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._buttons=$("#pageObjectTypeID");this._buttons.change($.proxy(this._click,this));this._didInit=true},_click:function(b){var a=$("#pageObjectTypeID").val();this._proxy.setOption("data",{actionName:"getTypeSpecificForm",className:"cms\\data\\page\\PageAction",parameters:{objectTypeID:a,pageID:this._pageID}});this._proxy.sendRequest()},_success:function(b,c,a){$("#specific").html(b.returnValues.template)}});